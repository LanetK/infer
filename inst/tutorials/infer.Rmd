---
title: "Getting to Know infer"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    df_print: default
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
library(tidyverse)
library(infer)
tutorial_options(exercise.timelimit = 60,
                 exercise.checker = gradethis::grade_learnr)
```

## Welcome

In this tutorial, you will learn how to use the `infer` R package to conduct hypothesis tests on tidy data. Rather than providing methods for specific statistical tests, this package consolidates the principles that are shared among common hypothesis tests into a set of 4 main verbs (functions), supplemented with many utilities to visualize and extract value from their outputs.


### The `gss` Dataset

Throughout this tutorial, we'll make use of the `gss` dataset supplied by `infer`, containing a sample of 3000 observations of 11 variables from the *General Social Survey*. Print the `gss` dataset to check it out!

```{r gss, exercise = TRUE}
# check out the `gss` dataset
```


```{r gss-hint-1}
# Type `gss` and then click the Submit Answer button.
```

```{r gss-solution}
gss
```

```{r gss-check}
gradethis::grade_code(paste0(gradethis::random_praise(),
                        " Each of these rows is a survey response, containing",
                        " demographic information on the respondent as well",
                        " as some of their responses. See ?gss for more",
                        " information!"))
```


## The 4 Main Verbs

The workflow of this package is designed around four main verbs. Starting out with some dataset,

+ `specify()` allows you to specify the variable, or relationship between variables, that you're interested in.
+ `hypothesize()` allows you to declare the null hypothesis.
+ `generate()` allows you to generate data reflecting the null hypothesis.
+ `calculate()` allows you to calculate a distribution of statistics from the generated data to form the null distribution.


## specify()

The `specify` function can be used to specify which of the variable(s) in the dataset you're interested in. If you're only interested in, say, the `age` of the respondents, you might write:

```{r specify_example, warning = FALSE, message = FALSE}
gss %>%
  specify(response = age)
```

On the front-end, the output of `specify` just looks like it selects off the columns in the dataframe that you've specified. Checking the class of this object, though:

```{r specify-one, warning = FALSE, message = FALSE}
gss %>%
  specify(response = age) %>%
  class()
```

We can see that the `infer` class has been appended on top of the dataframe classes--this new class stores some extra metadata.

## 

### Exercise

Let's try this out. Use `specify()` to specify interest in the `hours` variable from the `gss` dataset.

```{r specify, exercise = TRUE, warning = FALSE, message = FALSE}

```

```{r specify-hint-1}
# Try piping `gss` into `specify(response = hours)` 
# and then clicking the Submit Answer button.
```

```{r specify-hint-2}
# Type `gss %>% specify(response = hours)` 
# and then click the Submit Answer button.
```


```{r specify-solution}
gss %>% specify(response = hours)
```

```{r specify-check}
gradethis::grade_code(paste0(gradethis::random_praise()))
```

##

### specify() Two Variables

If you're interested in two variables--`age` and `partyid`, for example--you can `specify` their relationship in one of two (equivalent) ways:

```{r specify-two-example, eval = FALSE}
# as a formula
gss %>%
  specify(age ~ partyid)

# with the named arguments
gss %>%
  specify(response = age, explanatory = partyid)
```

Let's give this a shot, specifying interest in `hours` as a function of `college` with whichever syntax you prefer.

```{r specify-two, exercise = TRUE, warning = FALSE, message = FALSE}

```

```{r specify-two-hint-1}
# Try piping `gss` into `specify(response = hours, explanatory = college)` 
# and then clicking the Submit Answer button.
```

```{r specify-two-hint-2, eval = FALSE}
# Type `gss %>% specify(response = hours, explanatory = college)` 
# and then click the Submit Answer button.
```

```{r specify-two-check}
gradethis::grade_result(
  gradethis::pass_if(~ identical(.result, gss %>% 
                                   specify(response = hours, 
                                           explanatory = college)),
          gradethis::random_praise()))
```

## 

### specify() With Proportions

If you're doing inference on one proportion or a difference in proportions, you will need to use the `success` argument to specify which level of your `response` variable is a success. For instance, if you're interested in the proportion of the population with a college degree, you might use the following code:

```{r specify-success, eval = FALSE}
# specifying for inference on proportions
gss %>%
  specify(response = college, success = "degree")
```

## hypothesize()

The next step in the `infer` pipeline is often to declare a null hypothesis using `hypothesize()`. The first step is to supply one of `"independence"` or `"point"` to the `null` argument. If your null hypothesis assumes independence between two variables, then this is all you need to supply to `hypothesize()`:

```{r hypothesize-independence-example, eval = FALSE}
gss %>%
  specify(age ~ partyid) %>%
  hypothesize(null = "independence")
```

Again, if we ran this code,  the dataframe outputted from `hypothesize()` would look almost exactly the same as it did when it came out of `specify()`, but `infer` now "knows" your null hypothesis.

##

### Exercise

Starting off from the code we used to `specify()` the `hours` and `college`, `hypothesize()` that these two variables are independent of each other.

```{r hypothesize-two, exercise = TRUE, warning = FALSE, message = FALSE}
gss %>% 
  specify(response = hours, explanatory = college)
```

```{r hypothesize-two-hint-1}
# Try piping the provided code into `hypothesize(null = \"independence\")` 
# and then clicking the Submit Answer button."
```

```{r hypothesize-two-hint-2, eval = FALSE}
# Type: 
gss %>% 
  specify(response = hours, explanatory = college)
  hypothesize(null = "independence")
# and then click the Submit Answer button.
```

```{r hypothesize-two-check}
gradethis::grade_result(
  gradethis::pass_if(~ identical(.result, gss %>% 
                          specify(response = hours,
                                  explanatory = college) %>%
                          hypothesize("independence")),
          gradethis::random_praise()))
```


##

### Inference with Point Estimates

If you're doing inference on a point estimate, you will also need to provide one of `p` (the true proportion of successes, between 0 and 1), `mu` (the true mean), `med` (the true median), or `sigma` (the true standard deviation). For instance, if the null hypothesis is that the mean number of hours Americans work per week is 40, we would write:

```{r hypothesize-40-hr-week, eval = FALSE}
gss %>%
  specify(response = hours) %>%
  hypothesize(null = "point", mu = 40)
```

Alter the code from above to hypothesize that the true standard deviation of hours worked per week is 10.

```{r hypothesize-one, exercise = TRUE, warning = FALSE, message = FALSE}
gss %>%
  specify(response = hours) %>%
  hypothesize(null = "point", mu = 40)
```

```{r hypothesize-one-hint-1}
# The argument to put in place of `mu` is `sigma`.
```

```{r hypothesize-one-hint-2, eval = FALSE}
# Type:
gss %>% 
  specify(response = hours) %>%
  hypothesize(null = "point", sigma = 10)
# and then click the Submit Answer button.
```

```{r hypothesize-one-check}
gradethis::grade_result(
  gradethis::pass_if(~ identical(.result, gss %>%
                           specify(response = hours) %>%
                           hypothesize(null = "point", sigma = 10)),
          gradethis::random_praise()))
```


## generate()

Once we've asserted our null hypothesis using `hypothesize()`, we can construct a reference distribution based on this hypothesis. We can do this using one of several methods, supplied in the `type` argument:

* `bootstrap`: A bootstrap sample will be drawn for each replicate, where a sample of size equal to the input sample size is drawn (with replacement) from the input sample data.  
* `permute`: For each replicate, each input value will be randomly reassigned (without replacement) to a new output value in the sample.  
* `simulate`: A value will be sampled from a theoretical distribution with parameters specified in `hypothesize()` for each replicate. (This option is currently only applicable for testing point estimates.) 

Continuing on with our example from earlier, about the average number of hours worked a week, we might write:

```{r generate-point-example, eval = FALSE}
gss %>%
  specify(response = hours) %>%
  hypothesize(null = "point", mu = 40) %>%
  generate(reps = 1000, type = "bootstrap")
```

In the above example, we take 1000 bootstrap samples to form our reference distribution for the true mean number of hours worked per week. Modify the code below to generate a reference distribution for the true **median** number of hours worked per week from 500 repetitions drawn using the `bootstrap` generation type.

```{r generate-point, exercise = TRUE, warning = FALSE, message = FALSE}
gss %>%
  specify(response = hours) %>%
  hypothesize(null = "point", mu = 40) %>%
  generate(reps = 1000, type = "bootstrap")
```

```{r generate-point-hint-1}
# The argument to put in place of `mu` is `med`.
```

```{r generate-point-hint-2, eval = FALSE}
# Type: 
gss %>% 
  specify(response = hours) %>%
  hypothesize(null = "point", med = 40) %>%
  generate(reps = 500, type = "bootstrap")
# and then click the Submit Answer button.
```

```{r generate-point-solution}
gss %>% 
  specify(response = hours) %>%
  hypothesize(null = "point", med = 40) %>%
  generate(reps = 500, type = "bootstrap")
```

```{r generate-point-check}
gradethis::grade_code(correct = paste0(gradethis::random_praise(),
    " A smaller `reps` argument usually means that the code will run much",
    " faster, but also that the resulting reference distribution (and ",
    " inferences made from it) will be less accurate."))
```

##

### generate() with Two Variables

To generate a null distribution for the independence of two variables, imagine randomly reshuffling the pairings of explanatory and response variables to break any existing association. Modify the following code to generate **500** replicates using the "permute" generation type that can be used to create a reference distribution under the assumption that political party affiliation (`partyid`) is not affected by age (`age`):


```{r generate-permute, exercise = TRUE, warning = FALSE, message = FALSE}
gss %>%
  specify(partyid ~ age) %>%
  hypothesize(null = "independence")
```

```{r generate-permute-hint-1}
# Pipe the given code into a `generate()` call!
```

```{r generate-permute-hint-2, eval = FALSE}
# Type: 
gss %>%
  specify(partyid ~ age) %>%
  hypothesize(null = "independence") %>%
  generate(reps = 500, type = "permute")
# and then click the Submit Answer button.
```

```{r generate-permute-solution}
gss %>%
  specify(partyid ~ age) %>%
  hypothesize(null = "independence") %>%
  generate(reps = 500, type = "permute")
```

```{r generate-permute-check}
gradethis::grade_code(correct = paste0(gradethis::random_praise(),
    " That's it for generate()."))
```
